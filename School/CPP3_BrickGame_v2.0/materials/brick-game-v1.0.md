# Конечные автоматы

Конечный автомат (КА) в теории алгоритмов — математическая абстракция, модель дискретного устройства, имеющего один вход, один выход и в каждый момент времени находящегося в одном состоянии из множества возможных.

При работе на вход КА последовательно поступают входные воздействия, а на выходе КА формирует выходные сигналы. Переход из одного внутреннего состояния КА в другое может происходить не только от внешнего воздействия, но и самопроизвольно.

КА можно использовать для описания алгоритмов, позволяющих решать те или иные задачи, а также для моделирования практически любого процесса. Несколько примеров:

- Логика искусственного интеллекта для игр.
- Синтаксический и лексический анализ.
- Сложные компоненты.

Ниже представлены примеры использования КА для формализации игровой логики нескольких игр из BrickGame.

## Фроггер

![Фроггер](../misc/images/frogger-game.png)

Фроггер - одна из игр консоли Brickgame. Игра представляет из себя игровое поле, по которому движутся бревна, перепрыгивая по которым, игроку необходимо перевести лягушку с одного берега на другой. Если игрок попадает в воду или лягушка уходит за пределы игрового поля, то лягушка погибает. Игра завершается, когда игрок доводит лягушку до другого берега, или погибает последняя лягушка.

Для формализации логики данной игры можно представить следующий вариант конечного автомата:

![Конечный автомат фроггера](../misc/images/frogger-fsm.jpg)

Данный КА имеет следующие состояния:

- Старт - состояние, в котором игра ждет, пока игрок нажмет кнопку готовности к игре.
- Спавн - состояние, в котором создается очередная лягушка.
- Перемещение - основное игровое состояние с обработкой ввода от пользователя - движение лягушки по полосе влево/право или прыжки вперед/назад.
- Сдвиг - состояние, которое наступает после истечения таймера, при котором сдвигаются все объекты на полосах вправо, вместе с лягушкой.
- Столкновение - состояние, которое наступает, если после прыжка лягушка попадает в воду, или после смещения бревен лягушка оказывается за пределами игрового поля.
- Достигнут другой берег - состояние, которое наступает при достижении лягушкой верхней другого берега.
- Игра окончена - состояние, которое наступает после достижения другого берега или смерти последней лягушки.

## Тетрис

![Тетрис](../misc/images/tetris-game.png)

Тетрис наверное одна из самых популярных игр для консоли Brickgame. Нередко саму консоль и называют тетрисом. Цель игры заключается в наборе очков за построение линий из генерируемых игрой блоков. Очередной блок, сгенерированный игрой начинает опускаться вниз по игровому полю, пока не достигнет нижней границы или не столкнется с другим блоком. Пользовать может поворачивать фигуры и перемещать их по горизонтали, стараясь составлять ряды. После заполнения ряда, он уничтожается, игрок получает очки, а блоки, находящиеся выше заполненного ряда опускаются вниз. Игра заканчивается, когда очередная фигура останавливается в самом верхнем ряду.

Для формализации логики данной игры можно представить следующий вариант конечного автомата:

![Конечный автомат тетриса](../misc/images/tetris-fsm.png)

Данный КА состоит из следующих состояний:

- Старт - состояние, в котором игра ждет, пока игрок нажмет кнопку готовности к игре.
- Спавн - состояние, в которое переходит игра, при создании очередного блока и выбора следующего блока для спавна.
- Перемещение - основное игровое состояние с обработкой ввода от пользователя - поворот блоков/перемещение блоков по горизонтали.
- Сдвиг - состояние, в которое переходит игра после истечения таймера. В нем текущий блок перемещается вниз на один уровень.
- Соединение - состояние, в которое преходит игра, после "соприкосновения" текущего блока с уже упавшими или с землей. Если образуется заполненные линии, то она уничтожается и остальные блоки смещаются вниз. Если блок остановился в самом верхнем ряду, то игра переходит в состояние "игра окончена".
- Игра окончена - игра окончена.
